(function(e){require("../vendor/epitome/src/epitome"),require("../vendor/epitome/src/epitome-model-sync"),require("../vendor/epitome/src/epitome-collection-sync"),require("../vendor/epitome/src/epitome-view"),require("../vendor/epitome/src/epitome-storage");var t={};typeof define=="function"&&define.amd?define("formage",[],function(){return t}):typeof module=="object"?module.exports=t:e.Formage=t})(this),function(e){var t=require("storage"),n=require("model-sync"),r=require("settings"),i=new Class({options:{page:1,version:20,path:"models/{page}/{version}/manifest",useStorage:!0,urlRoot:"scripts/data",id:String.uniqueID()},Implements:[Options,Events,t],modified:!1,initialize:function(e,t){this.form=document.id(e),this.setOptions(t);var n=this;this.form.addEvent("change:relay(input,select,textarea)",function(e){n.modified=!0,n.fireEvent("change",this.BSreset()),n.validator.validateField(this),n.model.set(this.get("name"),this.get("value"))}).set({method:"post",action:"#!next"}),this.attachValidators()},attachValidators:function(){this.form.addEvent("reset",function(){this.getElements("input[type=text],input[type=email],select,textarea").BSreset()}),this.validator=new Form.Validator(this.form,{useTitles:!0,errorPrefix:"",evaluateFieldsOnBlur:!0,evaluateFieldsOnChange:!0,onElementValidate:function(e,t,n,r){e?t.BSreset():t.BSwarn(this.validators[n].getError(t))}})},attachButtons:function(){(new Element("button[type=submit][text=Do it]")).inject(this.form)},setPrivateKey:function(){var e="qs"+this.options.page;return this.options.privateKey===e?this:(this.options.privateKey=e,this.setupStorage(),this)},setupModel:function(e){e=e||{},e.id=this.options.id,this.model=new n(e,{urlRoot:this.options.urlRoot,onChange:function(e){},onSync:function(e){}})},getManifest:function(){var e=this;require([this.options.path.substitute(this.options)],function(t){e.setupModel();var n={sync:function(r){e.model.removeEvents(n),e.model.set(r),e.parseData(t)}};e.model.addEvents(n).read()})},parseData:function(e){var t=this.form.empty();this.modified=!1,this.options.useStorage&&this.setPrivateKey(),Array.each(e,function(e){var n="modules/types/"+e.type;require([n],function(n){new n(e.elements,e.title,{form:t})})}),this.attachButtons()}});Element.implement({BSwarn:function(e){var t="span.help-inline",n="div.control-group",r="div.radioWrapper",i=this.getParent(r),s,o,u=this,a="after";return this.BSreset(),o=this.getParent(n),o&&o.addClass("error"),!!i&&(u=i)&&(a="bottom"),s=o&&o.getElement(t)||(new Element(t)).inject(u,a),s&&s.set("html",e),this},BSreset:function(){var e="span.help-inline",t="div.control-group",n,r;return r=this.getParent(t),r&&r.removeClass("error"),n=r.getElement(e),n&&n.empty(),this}}),typeof define=="function"&&define.amd?define("formage-core",[],function(){return i}):typeof module=="object"?module.exports=i:e.Formage=i}(this),function(e){var t=require("settings"),n=require("formage-controller"),r=require("formage");r.Group=new Class({Implements:[Options,Events],options:{id:"QS",radioWrapper:"div.radioWrapper",autoInject:!0,form:t.form},setValue:function(e,t){var n=e.get(["tag","class"]),r,i=this.options.radioWrapper.split(".").getLast();switch(n.tag){case"div":n["class"].contains(i)&&(r=e.getElement("input[type=radio][value="+t+"]"),r&&r.set("checked",!0));break;default:e.set("value",t)}return this},getValue:function(e){var t=n.model&&n.model.get(e),r={value:null,error:null};return t&&(typeOf(t)=="array"?(r.value=t[0],r.error=t[1]):r.value=t),r},getLang:function(e){return Locale.get(this.options.id+"."+e)||e},createWrapper:function(){this.wrapper=new Element("fieldset.clear"),this.options.autoInject&&this.wrapper.inject(this.options.form)},setTitle:function(e){e&&e.length&&(new Element("legend",{html:e})).inject(this.wrapper,"top")}}),typeof define=="function"&&define.amd?define("formage-group",[],function(){return r}):typeof module=="object"?module.exports=r:e.Formage=r}(this),define("groups/mixin/formage-group",function(){}),function(e){var t=require("formage-main");t.Inline=new Class({Extends:t.Main,options:{autoInject:!1}}),typeof define=="function"&&define.amd?define("formage-inline",[],function(){return t}):typeof module=="object"?module.exports=t:e.Formage=t}(this),define("groups/types/formage-inline",function(){}),function(e){var t=require("mustache"),n=require("formage-group");n.Main=new Class({Extends:n.Group,options:{autoInject:!0},elements:[],changeAfter:[],initialize:function(e,t,n){this.setOptions(n),this.createWrapper(),this.setTitle(t),Array.each(e,this.processElement.bind(this)),this.fireChangeAfter()},fireChangeAfter:function(){this.changeAfter.invoke("fireEvent","change"),this.changeAfter=[]},processElement:function(e){var n={},r,i=require("text!templates/input-container.html");n.id=e.id,n.label=this.getLang(e.id),r=t.render(i,n),this.elements.push((new Element("div",{html:r})).inject(this.wrapper));var s=this[e.type+"Processor"](e).replaces(this.wrapper.getElement("#replaced")),o=this.getValue(e.name),u=o.value,a=o.error;u!==null&&this.setValue(s,u)&&this.changeAfter.push(s),a!==null&&this.makeError(s,a),e.dependencies&&this.grabDependencies(e,s)},makeError:function(e,t){var n=e.get(["tag","class"]);return e.BSwarn(t),this},grabDependencies:function(e,t){var n=typeOf(e.dependenciesValueTrigger)=="array"?e.dependenciesValueTrigger:[e.dependenciesValueTrigger];n.each(function(n){if(!e.dependencies[n])return;var r="modules/types/"+e.dependencies[n].type;require([r],function(r){var i=new r(e.dependencies[n].elements,e.dependencies[n].title);t.addEvent("change",function(){this.retrieve("getValue")()===n?i.wrapper.inject(t.getParent("div.control-group"),"after"):i.wrapper.dispose()})})})},textProcessor:function(e){var t=new Element("input",Object.merge({type:"text",id:e.id,name:e.name,value:e.defaultValue},e.constructorAttributes));return t.store("getValue",function(){return t.get("value")})},radioProcessor:function(e){var n=new Element(this.options.radioWrapper,e.wrapperAttributes||{}),r=require("text!templates/radio-input.html"),i=[],s;return Array.each(e.values,function(n,o){n.name=e.name,n.id=e.id+o,n["class"]&&(n["class"]="class="+n["class"]),e.defaultValue&&e.defaultValue==n.value&&(n.checked='checked="checked"')&&(s=n.id),i.push(t.render(r,n))}),s&&this.wrapper.getElement("label[for="+e.id+"]").set("for",s),e.constructorAttributes&&e.constructorAttributes.class&&n.addClass(e.constructorAttributes.class),n.set("html",i.join("\n")).store("getValue",function(){var e=n.getElement("input[type=radio]:checked");return e&&e.get("value")||null})},selectProcessor:function(e){var t=new Element("select",Object.merge({id:e.id,name:e.name},e.wrapperAttributes));return Array.each(e.values,function(n){var r=new Element("option");typeof e.defaultValue!="undefined"&&e.defaultValue==n.value&&r.set("selected",!0),r.set({value:n.value,text:n.label,disabled:n.disabled}).inject(t)}),t.store("getValue",function(){return t.get("value")})}}),typeof define=="function"&&define.amd?define("formage-main",[],function(){return n}):typeof module=="object"?module.exports=n:e.Formage=n}(this),define("groups/types/formage-main",function(){})